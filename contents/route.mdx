---
slug: 'route'
title: 'React CSR 초기 로딩부터 라우팅까지'
description: 'CSR 환경, 초기 로딩부터 라우팅까지의 브라우저 내부 동작 흐름을 정리합니다.'
tags: ['React', 'CSR', 'React Router']
date: '2024.12.09'
readingTime: '3분'
---

### React CSR 환경, 초기 로딩부터 라우팅까지의 브라우저 내부 동작 흐름

1. HTML 파싱과 자원 로드 ￼

   - 브라우저가 HTML을 파싱해 DOM과 CSSOM을 만듭니다.
     `<script src="app.bundle.js">` 같은 번들을 다운로드·실행 대기 상태

   - 번들이 ESM이면 모듈 그래프(정적 import)와 동적 import(lazy 청크)를 분리해 네트워크 요청 시작
     이때 라우트별 lazy 청크는 아직 필요 시점까지 대기

2. React 런타임 초기화 ￼

   - 번들이 실행되면 React와 ReactDOM 코드가 초기화
     React는 스케줄러, 파이버(섀도우 트리), 렌더/커밋 루프 등 내부 런타임을 준비

   - 앱 엔트리(보통 index.tsx)가 실행되어 라우터 객체 생성과 루트 노드 준비

3. createRoot 실행과 루트 파이버 생성 ￼

   - `createRoot`가 호출되면 ReactDOM이 지정된 컨테이너(#root)에 대한 Root Fiber를 만들고,
     이후 `render()` 호출로 가상트리(React 엘리먼트)를 루트에 커밋할 준비

   - 이 시점에서 화면은 아직 바뀌지 않았고, React가 첫 렌더를 스케줄링

4. RouterProvider 마운트와 라우터 초기 세팅 ￼

   - RouterProvider가 마운트되며 내부에서 History API를 구독, 현재 location을 읽음

   - 라우터는 라우트 트리를 매칭해 현재 URL에 해당하는 경로(중첩 포함)를 결정

   - 해당 경로가 lazy를 가진 경우, 즉시 그 모듈을 동적 import를 함과 동시에 라우트의 loader가 정의되어 있으면 병렬로 데이터 요청
     이는 렌더 후 fetch를 시작하던 순차 패턴을 없애 Network Waterfalls를 줄일 수 있음

5. 첫 렌더와 커밋 ￼

   - 라우터가 매칭 결과(컴포넌트, 로더 상태)를 바탕으로 React 엘리먼트 트리를 생성
     (로더가 진행 중이면 라우터가 로딩 UI(Suspense/스켈레톤)나 이전 화면 유지 등의 전략을 적용)

   - 준비가 끝나면 React가 커밋 단계에서 실제 DOM을 업데이트하고, 이벤트 핸들러를 바인딩
     사용자에게 초기 UI 노출

6. 네비게이션 중 동작 ￼

   - 링크 클릭 등으로 location이 바뀌면 라우터가 다시 매칭 → lazy import → loader 병렬 실행을 수행
   - 이전 요청은 AbortController로 취소되어 낭비를 줄이고, 오류는 ErrorBoundary로 라우트 단위 처리
   - 라우터는 스크롤 복원, 포커스 이동, 활성 링크 상태 등 UX 보조 기능을 수행
     ￼

내부적으로 중요한 포인트 요약 ￼

- URL→라우트 매칭

  라우트 트리의 랭킹/중첩 규칙으로 가장 구체적인 경로를 선택

- lazy + loader 병렬화

  경로 매칭 시점에 코드와 데이터를 동시에 준비해 렌더 후 요청하는 계단식 지연을 제거

- 취소·에러 관리

  새 네비게이션이 시작되면 이전 로더를 취소하고, 실패는 라우트별 ErrorBoundary로 세팅

- 렌더/커밋 루프

  React가 파이버를 통해 변경을 계산하고 DOM에 커밋 이 루프의 시작점이 `createRoot`

번들이 로드되면 React가 실행되고 `createRoot`로 렌더 엔진이 준비되며,
라우터가 URL을 매칭하는 순간 필요한 코드와 데이터를 병렬로 가져오도록 오케스트레이션
이 일련의 동작이 초기 표시와 전환 성능을 결정
